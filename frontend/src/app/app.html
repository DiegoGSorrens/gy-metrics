<div class="page">
  <h1>Gy Metrics</h1>

  <div class="card">
    <h2>Upload de arquivo</h2>
    <p class="muted">Envie um arquivo para processar e inserir métricas.</p>

    <input type="file" (change)="onFileSelected($event)" />

    <div class="actions" style="margin-top: 12px">
      <button (click)="sendFile()" [disabled]="!selectedFile">
        {{ 'Enviar' }}
      </button>

      <span class="error" *ngIf="uploadError">{{ uploadError }}</span>
      <span class="ok" *ngIf="uploadOk">{{ uploadOk }}</span>
    </div>
  </div>

  <div class="card">
    <div class="grid">
      <label>
        ID da
        <input type="number" [(ngModel)]="form.metricId" name="metricId" />
      </label>

      <label>
        Tipo
        <select [(ngModel)]="form.type" name="type">
          <option *ngFor="let t of types" [ngValue]="t">{{ t }}</option>
        </select>
      </label>

      <label>
        Data Inicial
        <input type="date" [(ngModel)]="form.dateInitial" name="dateInitial" />
      </label>

      <label>
        Data Final
        <input type="date" [(ngModel)]="form.finalDate" name="finalDate" />
      </label>
    </div>

    <div class="actions">
      <button (click)="getAggregations()">
        {{ 'Buscar' }}
      </button>
      <span class="error" *ngIf="error">{{ error }}</span>
    </div>
  </div>

  <div class="card">
    <div class="header-row">
      <h2>Relatório</h2>

        <button (click)="downloadReport()" [disabled]="loading" *ngIf="rows.length > 0">
          Baixar Excel
        </button>
    </div>

    <div class="empty" *ngIf="rows.length === 0 && !error">Sem dados para exibir.</div>

    <div class="table-wrap" *ngIf="rows.length > 0">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Período</th>
            <th>Total</th>
            <th>Média</th>
            <th>Qtd</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of rows; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ r.period }}</td>
            <td>{{ formatValue(r.total) }}</td>
            <td>{{ formatValue(r.avg) }}</td>
            <td>{{ r.count }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="footer-row" *ngIf="rows.length > 0">
      <span class="muted">Linhas: {{ rows.length }}</span>
    </div>
  </div>
</div>
